<table id="_sys_url_type_table"></table>
<script type="text/javascript" src="${baseUrl}/static/easyui/ext/datagrid-cellediting.js"></script>
<script>
	$('#_sys_url_type_table').datagrid({
	    url:'${baseUrl}/crm/sys/url_type/get',
	    columns:[[
	        {field:'url_type_id',title:'ID',width:35},
	        {field:'url_type_name',title:'类型名称',width:250,editor:'text'},
	        {field:'url_type_icon',title:'类型图标',width:150,editor:'text'}
	    ]],
	    pagination:true,
	    pagePosition:'top',
	    singleSelect:true
	}).datagrid('enableCellEditing');
	
	$('#_sys_url_type_table').datagrid('getPager').pagination({
		displayMsg:'位置: {from} 到 {to} 行，共计 {total} 项',
		layout:['list','sep','first','prev','sep','links','sep','next','last','sep','refresh'],
		buttons:[{
			iconCls: 'fa fa-plus',
			handler: function(){
				addRow();
				}
		},'-',{
			iconCls: 'fa fa-remove',
			handler: function(){
				endEdit();
			}
		},'-',{
			iconCls: 'fa fa-save',
			handler: function(){
				saveRow();
				}
		},'-']
    });
	
	function addRow(){
		endEdit();
		$('#_sys_url_type_table').datagrid('appendRow',{});
    }
	
	function saveRow(){
		endEdit();
		var insertRows = $('#_sys_url_type_table').datagrid('getChanges','inserted');
		var updateRows = $('#_sys_url_type_table').datagrid('getChanges','updated');
		var deleteRows = $('#_sys_url_type_table').datagrid('getChanges','deleted');
		var changesRows = {
			inserted : [],
			updated : [],
			deleted : [],
		};
		if (insertRows.length>0) {
				for (var i=0;i<insertRows.length;i++) {
					changesRows.inserted.push(insertRows[i]);
				}
			}

			if (updateRows.length>0) {
				for (var k=0;k<updateRows.length;k++) {
					changesRows.updated.push(updateRows[k]);
				}
			}
			
			if (deleteRows.length>0) {
				for (var j=0;j<deleteRows.length;j++) {
					changesRows.deleted.push(deleteRows[j]);
				}
			}

			console.log(JSON.stringify(changesRows));
		$.post("${baseUrl}/crm/sys/url_type/save", {changes:JSON.stringify(changesRows)}, function(data) {
			console.log(data);
		});
	}

	function endEdit() {
		var editCell = $('#_sys_url_type_table').datagrid('cell');
		if (editCell) {
			$('#_sys_url_type_table').datagrid('endEdit', editCell.index);
		}
	}
</script>